<!DOCTYPE html>
<html>
<head>
    <title>YouTube Connect</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>YouTube Connect</h1>
    <button id="connect-button">Connect</button>
    <div id="video-table-container" style="display:none;">
        <table>
            <thead>
                <tr>
                    <th>Thumbnail</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="video-table-body">
                <!-- Video rows will be inserted here -->
            </tbody>
        </table>
    </div>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        let GoogleAuth;

        function initClient() {
            gapi.client.init({
                'apiKey': 'apiKey',
                'clientId': 'clientId',
                'scope': 'https://www.googleapis.com/auth/youtube.force-ssl',
                'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest'],
                'cookiePolicy': 'single_host_origin'  // This sets the cookie policy
            }).then(() => {
                GoogleAuth = gapi.auth2.getAuthInstance();
                document.getElementById('connect-button').onclick = handleAuthClick;
            });
        }

        function handleAuthClick() {
            GoogleAuth.signIn().then(() => {
                loadYouTubeVideos();
            });
        }

        function loadYouTubeVideos() {
            gapi.client.youtube.channels.list({
                mine: true,
                part: 'contentDetails'
            }).then(response => {
                const uploadsPlaylistId = response.result.items[0].contentDetails.relatedPlaylists.uploads;
                return gapi.client.youtube.playlistItems.list({
                    playlistId: uploadsPlaylistId,
                    part: 'snippet',
                    maxResults: 10
                });
            }).then(response => {
                const videos = response.result.items;
                const tableBody = document.getElementById('video-table-body');
                tableBody.innerHTML = '';

                videos.forEach(video => {
                    const videoId = video.snippet.resourceId.videoId;
                    const title = video.snippet.title;
                    const description = video.snippet.description;
                    const thumbnail = video.snippet.thumbnails.default.url;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><img src="${thumbnail}" alt="Thumbnail"></td>
                        <td>${title}</td>
                        <td contenteditable="true">${description}</td>
                        <td><button onclick="updateDescription('${videoId}', this)">Update</button></td>
                    `;
                    tableBody.appendChild(row);
                });

                document.getElementById('video-table-container').style.display = 'block';
            });
        }

        function updateDescription(videoId, button) {
            const row = button.closest('tr');
            const newDescription = row.querySelector('td[contenteditable]').innerText;

            gapi.client.youtube.videos.update({
                part: 'snippet',
                id: videoId,
                snippet: {
                    description: newDescription
                }
            }).then(() => {
                alert('Description updated successfully!');
            });
        }

        gapi.load('client:auth2', initClient);
    </script>
</body>
</html>
